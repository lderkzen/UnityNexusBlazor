@page "/admin/groups/manage"

<PageTitle>Manage Groups | UnityNexus</PageTitle>

<h4 class="mt-3">
    Configure groups
</h4>

<Row>
    <Column ColumnSize="ColumnSize.IsFull">
        <Card>
            @if (_groups is null || _categories is null)
            {
                <CardBody>
                    <p>Loading...</p>
                </CardBody>
            }
            else
            {
                <CardBody>
                    <DataGrid TItem="GroupModel" Data="@_groups" Editable="false" EditMode="DataGridEditMode.Popup"
                        RowInserted="@GroupAddedAsync" RowUpdated="@GroupUpdatedAsync" PageSize="10" Sortable="false"
                        Striped="true" Bordered="false">
                        <DataGridCommandColumn TItem="GroupModel" DeleteCommandAllowed="false">
                            <NewCommandTemplate>
                                <DataGridNewCommand CommandContext="@context" />
                            </NewCommandTemplate>
                            <EditCommandTemplate>
                                <DataGridEditCommand TItem="GroupModel" CommandContext="@context" />
                            </EditCommandTemplate>
                            <SaveCommandTemplate>
                                <DataGridSaveCommand TItem="GroupModel" CommandContext="@context" />
                            </SaveCommandTemplate>
                            <CancelCommandTemplate>
                                <DataGridCancelCommand TItem="GroupModel" CommandContext="@context" />
                            </CancelCommandTemplate>
                        </DataGridCommandColumn>
                        <DataGridColumn TItem="GroupModel" Field="@nameof(GroupModel.Id)" Caption="Preview"
                            Editable="false">
                            <DisplayTemplate>
                                @{
                                    if (context is GroupModel model)
                                    {
                                        <GroupBadge Model="@model" />
                                    }
                                }
                            </DisplayTemplate>
                        </DataGridColumn>
                        <DataGridColumn TItem="GroupModel" Field="@nameof(GroupModel.CategoryId)" Editable="false">
                            <DisplayTemplate>
                                @{
                                    if (context is GroupModel model && model.CategoryId is not null)
                                    {
                                        <CategoryBadge Model="@_categories[(int)model.CategoryId]" />
                                    }
                                    else
                                    {
                                        @("Unavailable")
                                    }
                                }
                            </DisplayTemplate>
                        </DataGridColumn>
                        <DataGridColumn TItem="GroupModel" Field="@nameof(GroupModel.Title)" Caption="Title"
                            Editable="false">
                            <DisplayTemplate>
                                @{
                                    if (context is GroupModel model)
                                    {
                                        @(model.Title)
                                    }
                                }
                            </DisplayTemplate>
                        </DataGridColumn>
                        <DataGridColumn TItem="GroupModel" Field="@nameof(GroupModel.NotificationChannelId)"
                            Caption="Notification Channel" Editable="false">
                            <DisplayTemplate>
                                @{
                                    if (context is GroupModel model)
                                    {
                                        @(model.NotificationChannelId ?? "None")
                                    }
                                }
                            </DisplayTemplate>
                        </DataGridColumn>
                        <DataGridColumn TItem="GroupModel" Field="@nameof(GroupModel.IsLocked)" Caption="Locked"
                            Editable="false">
                            <DisplayTemplate>
                                @{
                                    if (context is GroupModel model)
                                    {
                                        @(model.IsLocked ? "Yes" : "No")
                                    }
                                }
                            </DisplayTemplate>
                        </DataGridColumn>
                        <DataGridColumn TItem="GroupModel" Field="@nameof(GroupModel.CreatedAt)" Caption="Created At"
                            Editable="false">
                            <DisplayTemplate>
                                @{
                                    if (context is GroupModel model)
                                    {
                                        @(model.CreatedAt?.ToString("yyyy-MM-dd HH:mm") ?? "Unavailable")
                                    }
                                }
                            </DisplayTemplate>
                        </DataGridColumn>
                        <DataGridColumn TItem="GroupModel" Field="@nameof(GroupModel.UpdatedAt)" Caption="Updated At"
                            Editable="false">
                            <DisplayTemplate>
                                @{
                                    if (context is GroupModel model)
                                    {
                                        @(model.UpdatedAt?.ToString("yyyy-MM-dd HH:mm") ?? "Unavailable")
                                    }
                                }
                            </DisplayTemplate>
                        </DataGridColumn>
                        <DataGridColumn TItem="GroupModel" Field="@nameof(GroupModel.IsDeleted)" Caption="Deleted"
                            Editable="false">
                            <DisplayTemplate>
                                @{
                                    if (context is GroupModel model)
                                    {
                                        @(model.IsDeleted ? "Yes" : "No")
                                    }
                                }
                            </DisplayTemplate>
                        </DataGridColumn>
                    </DataGrid>
                </CardBody>
            }
        </Card>
    </Column>
</Row>
